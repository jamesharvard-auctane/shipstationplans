<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ShipStation Platform and Plan Recommender</title>
<style>
  :root{
    --bg:#0b0f14; --card:#121822; --muted:#9fb3c8; --text:#e6edf3; --accent:#7cc4ff; --accent2:#4de1c1; --border:#1f2937; --focus:#7cc4ff55;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;color:var(--text);background:linear-gradient(180deg,#0b0f14,#0b1016 40%,#0b0f14)}
  .container{max-width:980px;margin:0 auto;padding:20px}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px}
  .title{font-size:clamp(20px,2.6vw,28px);font-weight:700}
  .subtitle{color:var(--muted);font-size:14px}
  .pill{padding:6px 10px;border-radius:999px;background:#0e1420;border:1px solid var(--border);font-size:12px;color:var(--muted)}
  .row{display:flex;gap:8px;flex-wrap:wrap}
  .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:16px;margin:14px 0;box-shadow:0 10px 30px rgba(0,0,0,.25)}
  .section-title{font-size:18px;font-weight:700;margin:6px 0 14px;border-left:4px solid var(--accent);padding-left:10px}
  fieldset{border:none;padding:0;margin:0 0 8px}
  legend{font-weight:600;margin-bottom:8px}
  label.option{display:flex;align-items:center;gap:10px;padding:12px;border:1px solid var(--border);border-radius:12px;background:#0f1520;cursor:pointer}
  label.option:hover{border-color:#2b3a4f}
  input[type=radio],input[type=checkbox]{width:18px;height:18px}
  select{width:100%;padding:12px;border-radius:10px;border:1px solid var(--border);background:#0f1520;color:var(--text)}
  .grid{display:grid;gap:10px}
  @media(min-width:700px){.cols-2{grid-template-columns:1fr 1fr}}
  .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
  .btn{appearance:none;border:none;border-radius:12px;padding:12px 16px;font-weight:700;cursor:pointer;color:#061016;background:linear-gradient(135deg,var(--accent),var(--accent2));box-shadow:0 6px 20px rgba(80,180,220,.35)}
  .btn.secondary{background:#101826;color:var(--text);border:1px solid var(--border)}
  .btn.link{background:transparent;border:1px dashed var(--border);color:var(--text)}
  .hidden{display:none !important}
  .result{display:none}
  .result.show{display:block}
  .score-badges{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0}
  .score{border:1px solid var(--border);background:#0f1520;border-radius:10px;padding:6px 10px;font-size:12px}
  .banner{border:1px dashed #2b3a4f;background:#0d1420;padding:14px;border-radius:12px;margin:12px 0}
  table{width:100%;border-collapse:collapse;font-size:14px}
  th,td{padding:10px;border-bottom:1px solid var(--border);text-align:left}
  th{color:var(--muted);font-weight:600}
  .muted{color:var(--muted)}
  input:focus-visible + span, label.option:has(input:focus-visible){outline:3px solid var(--focus)}
</style>
</head>
<body>
<div class="container">
  <header>
    <div>
      <div class="title">ShipStation Platform and Plan Recommender</div>
      <div class="subtitle">Mobile friendly guided discovery for field reps · Requirement based plan selection</div>
    </div>
    <div class="row">
      <span class="pill">UI or API Gate</span>
      <span class="pill">Free • Starter • Standard • Premium</span>
      <span class="pill">Shows what forced higher plan</span>
    </div>
  </header>

  <!-- Step 1: Platform Gate -->
  <section class="card" id="sec-platform">
    <div class="section-title">Step 1 · Choose Platform</div>
    <fieldset>
      <legend class="muted">Where do they want to print their labels?</legend>
      <div class="grid">
        <label class="option"><input type="radio" name="platform" value="UI"> <span>In our app (ShipStation UI)</span></label>
        <label class="option"><input type="radio" name="platform" value="API"> <span>In their system (ShipStation API)</span></label>
      </div>
    </fieldset>
  </section>

  <!-- API Path -->
  <section class="card hidden" id="sec-api">
    <div class="section-title">API Path · Quick Questions</div>
    <fieldset>
      <legend>Do they have access to developer resources?</legend>
      <div class="grid">
        <label class="option"><input type="radio" name="api_dev" value="Yes"> <span>Yes</span></label>
        <label class="option"><input type="radio" name="api_dev" value="No"> <span>No (Connect with API Partner)</span></label>
      </div>
    </fieldset>
    <fieldset>
      <legend>Do they need 3PL functionality?</legend>
      <div class="grid">
        <label class="option"><input type="radio" name="api_3pl" value="Yes"> <span>Yes</span></label>
        <label class="option"><input type="radio" name="api_3pl" value="No"> <span>No</span></label>
      </div>
    </fieldset>
    <fieldset>
      <legend>Do they need Platform Elements?</legend>
      <div class="grid">
        <label class="option"><input type="radio" name="api_pe" value="Yes"> <span>Yes</span></label>
        <label class="option"><input type="radio" name="api_pe" value="No"> <span>No</span></label>
      </div>
    </fieldset>
  </section>

  <!-- UI Path: Users and Shipments -->
  <section class="card hidden" id="sec-ui-users">
    <div class="section-title">UI Path · Users and Shipments</div>
    <fieldset>
      <legend>How many users do you need?</legend>
      <div class="grid cols-2">
        <label class="option"><input type="radio" name="users" value="1 User"> <span>1 User</span></label>
        <label class="option"><input type="radio" name="users" value="3 Users"> <span>3 Users</span></label>
        <label class="option"><input type="radio" name="users" value="4-10 Users"> <span>4-10 Users</span></label>
        <label class="option"><input type="radio" name="users" value="11-15 Users"> <span>11-15 Users</span></label>
      </div>
    </fieldset>
    <fieldset>
      <legend>How many shipments each month?</legend>
      <select name="shipments" id="shipments">
        <option value="">Select...</option>
        <option>10</option>
        <option>50</option>
        <option>100</option>
        <option>500</option>
        <option>1,000</option>
        <option>2,000</option>
        <option>5,000</option>
        <option>7,500</option>
        <option>10,000</option>
        <option>15,000</option>
        <option>20,000</option>
        <option>>20,000</option>
      </select>
    </fieldset>
  </section>

  <!-- UI Path: Features -->
  <section class="card hidden" id="sec-ui-features">
    <div class="section-title">UI Path · Features</div>
    <div class="grid cols-2">
      <fieldset>
        <legend>International Shipping (Non Wallet)?</legend>
        <label class="option"><input type="radio" name="intl" value="No"> <span>No</span></label>
        <label class="option"><input type="radio" name="intl" value="Yes"> <span>Yes</span></label>
      </fieldset>
      <fieldset>
        <legend>BYOA?</legend>
        <label class="option"><input type="radio" name="byoa" value="No"> <span>No</span></label>
        <label class="option"><input type="radio" name="byoa" value="Yes"> <span>Yes</span></label>
      </fieldset>
      <fieldset>
        <legend>Inventory management level?</legend>
        <label class="option"><input type="radio" name="inv" value="None"> <span>None</span></label>
        <label class="option"><input type="radio" name="inv" value="Product Catalog and Inventory Grid"> <span>Product Catalog and Inventory Grid</span></label>
        <label class="option"><input type="radio" name="inv" value="Basic Inventory Management"> <span>Basic Inventory Management</span></label>
        <label class="option"><input type="radio" name="inv" value="Advanced Inventory Management"> <span>Advanced Inventory Management</span></label>
      </fieldset>
      <fieldset>
        <legend>Warehouse management level?</legend>
        <label class="option"><input type="radio" name="wm" value="Standard packing slips"> <span>Standard packing slips</span></label>
        <label class="option"><input type="radio" name="wm" value="Standard Pick Lists and Packing Slips"> <span>Standard Pick Lists and Packing Slips</span></label>
        <label class="option"><input type="radio" name="wm" value="Advanced Warehouse Management"> <span>Advanced Warehouse Management</span></label>
        <label class="option"><input type="radio" name="wm" value="All Warehouse Management features"> <span>All Warehouse Management features</span></label>
      </fieldset>
      <fieldset>
        <legend>Advanced return and exchange options?</legend>
        <label class="option"><input type="radio" name="returns" value="No"> <span>No</span></label>
        <label class="option"><input type="radio" name="returns" value="Yes"> <span>Yes</span></label>
      </fieldset>
      <fieldset>
        <legend>Unlimited rule automations?</legend>
        <label class="option"><input type="radio" name="rules" value="No"> <span>No</span></label>
        <label class="option"><input type="radio" name="rules" value="Yes"> <span>Yes</span></label>
      </fieldset>
      <fieldset>
        <legend>Auto Routing or Auto Split?</legend>
        <label class="option"><input type="radio" name="routing" value="No"> <span>No</span></label>
        <label class="option"><input type="radio" name="routing" value="Yes"> <span>Yes</span></label>
      </fieldset>
      <fieldset>
        <legend>Rate Shopper?</legend>
        <label class="option"><input type="radio" name="rates" value="Freemium Rate Shopper"> <span>Freemium Rate Shopper</span></label>
        <label class="option"><input type="radio" name="rates" value="Advanced Rate Shopper"> <span>Advanced Rate Shopper</span></label>
      </fieldset>
      <fieldset>
        <legend>ODBC?</legend>
        <label class="option"><input type="radio" name="odbc" value="No"> <span>No</span></label>
        <label class="option"><input type="radio" name="odbc" value="Yes"> <span>Yes</span></label>
      </fieldset>
      <fieldset>
        <legend>API Access?</legend>
        <label class="option"><input type="radio" name="api_access" value="No"> <span>No</span></label>
        <label class="option"><input type="radio" name="api_access" value="Yes"> <span>Yes</span></label>
      </fieldset>
      <fieldset>
        <legend>Phone Support or Dedicated AM?</legend>
        <label class="option"><input type="radio" name="support" value="No"> <span>No</span></label>
        <label class="option"><input type="radio" name="support" value="Phone Support"> <span>Phone Support</span></label>
        <label class="option"><input type="radio" name="support" value="Dedicated AM"> <span>Dedicated Account Manager</span></label>
      </fieldset>
    </div>
  </section>

  <!-- Add ons -->
  <section class="card hidden" id="sec-addons">
    <div class="section-title">Add ons</div>
    <fieldset>
      <legend>Do they need any of these add ons?</legend>
      <div class="grid cols-2">
        <label class="option"><input type="checkbox" name="addons" value="Fulfillment"> <span>Fulfillment</span></label>
        <label class="option"><input type="checkbox" name="addons" value="3PL Manager"> <span>3PL Manager</span></label>
        <label class="option"><input type="checkbox" name="addons" value="Dropship Manager"> <span>Dropship Manager</span></label>
      </div>
    </fieldset>
    <div class="actions">
      <button class="btn" id="btn-calc">Show Recommendation</button>
      <button class="btn secondary" id="btn-reset" type="button">Reset</button>
    </div>
  </section>

  <!-- Results -->
  <section class="card result" id="sec-result">
    <div class="section-title">Recommendation</div>
    <div class="banner" id="rec-banner"></div>
    <div class="score-badges" id="driver-badges"></div>
    <table id="recap-table"></table>
    <div class="actions">
      <button class="btn link" id="btn-copy" type="button">Copy Summary</button>
      <button class="btn link" id="btn-download" type="button">Download JSON</button>
    </div>
    <div class="subtitle muted" style="margin-top:10px">We pick the lowest cost plan that satisfies all selected requirements. Drivers list shows which features required the recommended plan.</div>
  </section>
</div>

<script>
(function(){
  var q = function(sel,ctx){return (ctx||document).querySelector(sel)};
  var qa = function(sel,ctx){return Array.prototype.slice.call((ctx||document).querySelectorAll(sel))};
  var show = function(el,yes){ el.classList.toggle('hidden', !yes); };

  var PLAN_ORDER = ['Free','Starter','Standard','Premium'];
  var PLAN_INDEX = {Free:0, Starter:1, Standard:2, Premium:3};

  // Pricing loaded from your spreadsheet (plan and shipment band specific)
  // Keys for shipment bands are normalized like: "10","50","100","500","1000","2000","5000","7500","10000","15000","20000",">20000"
  var PRICES = {
    "Free":    {"10": 0.00},
    "Starter": {"50":14.99,"100":29.99,"500":39.99,"1000":79.99,"2000":119.99,"5000":174.99},
    "Standard":{"50":29.99,"100":59.99,"500":89.99,"1000":149.99,"2000":174.99,"5000":249.99,"7500":299.99,"10000":599.99,"15000":649.99,"20000":799.99,">20000":"Custom Pricing"},
    "Premium": {"50":349.99,"100":399.99,"500":449.99,"1000":599.99,"2000":699.99,"5000":799.99,"7500":949.99,"10000":1099.99,"15000":1349.99,"20000":1499.99,">20000":"Custom Pricing"}
  };

  // Visibility based on platform
  qa('input[name=platform]').forEach(function(r){
    r.addEventListener('change', function(){
      var v = q('input[name=platform]:checked');
      v = v ? v.value : '';
      show(q('#sec-api'), v==='API');
      show(q('#sec-ui-users'), v==='UI');
      show(q('#sec-ui-features'), v==='UI');
      show(q('#sec-addons'), true);
      q('#sec-result').classList.remove('show');
      window.scrollTo({top:q('#sec-addons').offsetTop - 12, behavior:'smooth'});
    });
  });

  // Requirement maps: answer -> allowed plans
  function S(){ return new Set(PLAN_ORDER); }
  function allowed(field, value){
    switch(field){

      // Users → minimum plan
      case 'users':
        if(value==='1 User') return new Set(['Free']);
        if(value==='3 Users') return new Set(['Starter']);
        if(value==='4-10 Users') return new Set(['Standard']);
        if(value==='11-15 Users') return new Set(['Premium']);
        break;

      // Shipments → allowed by plan availability from your list
      case 'shipments':
        var n = normalizeShip(value);
        // derive allowed plans by presence in PRICES
        var ok = new Set();
        PLAN_ORDER.forEach(function(p){
          if(PRICES[p] && Object.prototype.hasOwnProperty.call(PRICES[p], n)) ok.add(p);
        });
        return ok;

      case 'intl':
        return (value==='Yes') ? new Set(['Standard','Premium']) : new Set(['Free','Starter']);
      case 'byoa':
        return (value==='Yes') ? new Set(['Standard','Premium']) : new Set(['Starter','Standard']);
      case 'inv':
        if(value==='None') return new Set(['Free']);
        if(value==='Product Catalog and Inventory Grid') return new Set(['Starter']);
        if(value==='Basic Inventory Management') return new Set(['Standard']);
        if(value==='Advanced Inventory Management') return new Set(['Premium']);
        break;
      case 'wm':
        if(value==='Standard packing slips') return new Set(['Free']);
        if(value==='Standard Pick Lists and Packing Slips') return new Set(['Starter']);
        if(value==='Advanced Warehouse Management') return new Set(['Standard']);
        if(value==='All Warehouse Management features') return new Set(['Premium']);
        break;
      case 'returns':
        return (value==='Yes') ? new Set(['Standard','Premium']) : new Set(['Free','Starter']);
      case 'rules':
        return (value==='Yes') ? new Set(['Standard','Premium']) : new Set(['Free','Starter']);
      case 'routing':
        return (value==='Yes') ? new Set(['Premium']) : new Set(['Free','Starter','Standard']);
      case 'rates':
        return (value==='Advanced Rate Shopper') ? new Set(['Standard','Premium']) : new Set(['Free','Starter']);
      case 'odbc':
        return (value==='Yes') ? new Set(['Premium']) : new Set(['Free','Starter','Standard']);
      case 'api_access':
        return (value==='Yes') ? new Set(['Standard','Premium']) : new Set(['Free','Starter']);
      case 'support':
        if(value==='No') return new Set(['Free','Starter']);
        if(value==='Phone Support') return new Set(['Standard']);
        if(value==='Dedicated AM') return new Set(['Premium']);
        break;

      // API path (record only)
      case 'api_dev':
      case 'api_3pl':
      case 'api_pe':
        return S();

      default:
        return S();
    }
    return S();
  }

  function normalizeShip(v){
    if(!v) return '';
    var s = String(v).trim().toLowerCase().replace(/,/g,'');
    if(s.indexOf('>')===0 || s.indexOf('more than')===0) return '>20000';
    return s.replace(/^0+/,'');
  }

  function calcRecommendation(){
    var platform = (q('input[name=platform]:checked')||{}).value || '';

    // Gather answers
    var answers = {};
    var addons = qa('input[name=addons]:checked').map(function(c){ return c.value; });

    if(platform==='UI'){
      var fields = [
        'users','shipments','intl','byoa','inv','wm','returns','rules','routing','rates','odbc','api_access','support'
      ];
      fields.forEach(function(f){
        if(f==='shipments'){
          var val = q('#shipments').value;
          if(val) answers[f] = val;
        } else {
          var sel = q('input[name='+f+']:checked');
          if(sel && sel.value) answers[f] = sel.value;
        }
      });
    } else if(platform==='API'){
      ['api_dev','api_3pl','api_pe'].forEach(function(f){
        var sel = q('input[name='+f+']:checked');
        if(sel && sel.value) answers[f] = sel.value;
      });
    }

    // Requirement based plan: pick the highest minimum required by any answer, then finalize plan
    if(platform==='UI'){
      var minIndexRequired = 0; // Free baseline
      var drivers = []; // features that set or matched the final requirement
      var finalAllowed = new Set(PLAN_ORDER); // for feasibility check too

      Object.keys(answers).forEach(function(field){
        var value = answers[field];
        var allowedSet = allowed(field, value);
        // Update feasibility intersection
        finalAllowed = new Set(PLAN_ORDER.filter(function(p){ return finalAllowed.has(p) && allowedSet.has(p); }));
        // Minimum tier this answer demands
        var minTier = PLAN_ORDER.find(function(p){ return allowedSet.has(p); }) || 'Premium';
        var idx = PLAN_INDEX[minTier];
        if(idx > minIndexRequired){
          minIndexRequired = idx;
        }
      });

      // Recommended plan is the lowest cost plan that is at least minIndexRequired and still feasible with all answers
      var recommended = null;
      for(var i=minIndexRequired;i<PLAN_ORDER.length;i++){
        var pName = PLAN_ORDER[i];
        if(finalAllowed.has(pName)){ recommended = pName; break; }
      }
      // If contradiction left allowed empty, fall back to the minIndexRequired plan by order
      if(!recommended) recommended = PLAN_ORDER[minIndexRequired];

      // Identify driver features: those whose minimum tier equals the recommended plan (binding)
      Object.keys(answers).forEach(function(field){
        var value = answers[field];
        var allowedSet = allowed(field, value);
        var minTier = PLAN_ORDER.find(function(p){ return allowedSet.has(p); }) || 'Premium';
        if(minTier === recommended){
          drivers.push(driverLabel(field, value));
        }
      });

      // Price lookup based on plan and shipments
      var shipKey = normalizeShip(answers.shipments || '');
      var price = shipKey && PRICES[recommended] ? PRICES[recommended][shipKey] : undefined;
      var priceText = (price===undefined) ? 'N/A' : (price==='Custom Pricing' ? 'Custom Pricing' : ('$'+price.toFixed(2)+'/mo'));

      return { platform:platform, answers:answers, addons:addons, recommended:recommended, drivers:drivers, priceText:priceText };
    }

    // API path
    return { platform:platform, answers:answers, addons:addons, recommended:null, drivers:[], priceText:null };
  }

  function driverLabel(field, value){
    var labels = {
      users: 'Users: '+value,
      shipments: 'Shipments per month: '+value,
      intl: 'International Shipping: '+value,
      byoa: 'BYOA: '+value,
      inv: 'Inventory level: '+value,
      wm: 'Warehouse management level: '+value,
      returns: 'Advanced returns and exchanges: '+value,
      rules: 'Unlimited rule automations: '+value,
      routing: 'Auto Routing or Auto Split: '+value,
      rates: 'Rate Shopper: '+value,
      odbc: 'ODBC: '+value,
      api_access: 'API Access: '+value,
      support: 'Support: '+value,
      api_dev: 'Developer resources: '+value,
      api_3pl: '3PL functionality: '+value,
      api_pe: 'Platform Elements: '+value
    };
    return labels[field] || (field+': '+value);
  }

  function render(){
    var res = calcRecommendation();
    var banner = q('#rec-banner');
    var drivers = q('#driver-badges');
    var recap = q('#recap-table');

    if(res.platform==='API'){
      var dev = (q('input[name=api_dev]:checked')||{}).value || '—';
      var need3pl = (q('input[name=api_3pl]:checked')||{}).value || '—';
      var pe = (q('input[name=api_pe]:checked')||{}).value || '—';
      var partner = (dev==='No');
      banner.innerHTML =
        '<div><strong>Platform:</strong> ShipStation API</div>'+
        '<div class="muted">Dev resources: <strong>'+dev+'</strong> · 3PL: <strong>'+need3pl+'</strong> · Platform Elements: <strong>'+pe+'</strong></div>'+
        '<div style="margin-top:6px">Next Step: <strong>'+(partner? 'Connect with an API Partner' : 'Proceed with SS API solutioning')+'</strong></div>'+
        '<div style="margin-top:6px">Add ons: '+(res.addons.length? res.addons.join(', ') : 'None')+'</div>';
      drivers.innerHTML = '';
    } else if(res.platform==='UI'){
      banner.innerHTML =
        '<div><strong>Platform:</strong> ShipStation UI</div>'+
        '<div><strong>Recommended Plan:</strong> '+(res.recommended || '—')+(res.priceText? ' — '+res.priceText : '')+'</div>'+
        '<div style="margin-top:6px">Add ons: '+(res.addons.length? res.addons.join(', ') : 'None')+'</div>';

      // Drivers badges
      if(res.drivers.length){
        drivers.innerHTML = res.drivers.map(function(d){ return '<span class="score">'+d+'</span>'; }).join('');
      } else {
        drivers.innerHTML = '<span class="muted">No higher plan drivers detected. Selection fits the base tier.</span>';
      }
    } else {
      banner.innerHTML = '<div>Please select a platform to begin.</div>';
      drivers.innerHTML = '';
    }

    // Recap table
    var rows = [];
    if(res.platform==='UI'){
      rows.push(['Category','Answer']);
      var order = [
        ['users','How many users do you need?'],
        ['shipments','How many shipments each month?'],
        ['intl','International Shipping (Non Wallet)?'],
        ['byoa','BYOA?'],
        ['inv','Inventory management level?'],
        ['wm','Warehouse management level?'],
        ['returns','Advanced return and exchange options?'],
        ['rules','Unlimited rule automations?'],
        ['routing','Auto Routing or Auto Split?'],
        ['rates','Rate Shopper?'],
        ['odbc','ODBC?'],
        ['api_access','API Access?'],
        ['support','Phone Support or Dedicated AM?']
      ];
      order.forEach(function(pair){ var k=pair[0], label=pair[1]; if(res.answers[k]) rows.push([label, res.answers[k]]); });
    } else if(res.platform==='API'){
      rows.push(['Category','Answer']);
      if(res.answers.api_dev) rows.push(['Developer resources', res.answers.api_dev]);
      if(res.answers.api_3pl) rows.push(['3PL functionality', res.answers.api_3pl]);
      if(res.answers.api_pe) rows.push(['Platform Elements', res.answers.api_pe]);
    }

    recap.innerHTML = rows.length
      ? '<thead><tr><th>'+rows[0][0]+'</th><th>'+rows[0][1]+'</th></tr></thead>'+
        '<tbody>'+rows.slice(1).map(function(rw){ return '<tr><td>'+rw[0]+'</td><td>'+rw[1]+'</td></tr>'; }).join('')+'</tbody>'
      : '';

    q('#sec-result').classList.add('show');
    window.scrollTo({top:q('#sec-result').offsetTop - 12, behavior:'smooth'});
  }

  q('#btn-calc').addEventListener('click', render);
  q('#btn-reset').addEventListener('click', function(){
    qa('input[type=radio],input[type=checkbox]').forEach(function(i){ i.checked=false; });
    q('#shipments').value = '';
    [q('#sec-api'),q('#sec-ui-users'),q('#sec-ui-features'),q('#sec-addons')].forEach(function(s){ s.classList.add('hidden'); });
    q('#sec-result').classList.remove('show');
    window.scrollTo({top:0,behavior:'smooth'});
  });

  q('#btn-copy').addEventListener('click', function(){
    var r = calcRecommendation();
    var lines = [];
    if(!r.platform){ alert('Please complete the questionnaire.'); return; }
    lines.push('Platform: '+(r.platform==='UI'?'ShipStation UI':'ShipStation API'));
    if(r.platform==='UI'){
      lines.push('Recommended Plan: '+r.recommended + (r.priceText? ' — '+r.priceText : ''));
      lines.push('');
      lines.push('Drivers (features that required this plan):');
      if(r.drivers.length){ r.drivers.forEach(function(d){ lines.push('- '+d); }); }
      else { lines.push('- None'); }
    }
    lines.push('');
    lines.push('Answers:');
    Object.keys(r.answers).forEach(function(k){ lines.push('- '+k+': '+r.answers[k]); });
    lines.push('');
    lines.push('Add ons: ' + (r.addons.length? r.addons.join(', ') : 'None'));
    var text = lines.join('\n');

    if(navigator.clipboard && navigator.clipboard.writeText){
      navigator.clipboard.writeText(text).then(function(){ alert('Summary copied to clipboard.'); });
    } else {
      var ta = document.createElement('textarea'); ta.value = text; document.body.appendChild(ta); ta.select(); document.execCommand('copy'); document.body.removeChild(ta);
      alert('Summary copied to clipboard.');
    }
  });

  q('#btn-download').addEventListener('click', function(){
    var r = calcRecommendation();
    var blob = new Blob([JSON.stringify(r,null,2)], {type:'application/json'});
    var a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'shipstation_recommendation.json'; a.click(); URL.revokeObjectURL(a.href);
  });
})();
</script>
</body>
</html>
